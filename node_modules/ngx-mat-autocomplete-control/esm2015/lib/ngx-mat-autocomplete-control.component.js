import { Component, Input, Output, EventEmitter } from '@angular/core';
export class NgxMatAutocompleteControlComponent {
    constructor() {
        this.appearance = 'outline';
        this.options = [];
        this.required = false;
        this.showDefaultSelect = false;
        this.disabled = false;
        this.showPlaceholder = true;
        // @Input() inputText = '';
        // @Input() reactiveForm = true;
        // @Input() modelName = true;
        this.selectionChange = new EventEmitter();
        this.propValueEvent = new EventEmitter();
        this.keyUp = false;
        this.filterList = [];
    }
    ngOnChanges(changes) {
        if (changes) {
            if (+this.value > 0 || this.value.length > 0) {
                this.tempValue = this.control.value;
                this.setItems('');
                setTimeout(() => {
                    this.control.setValue(this.tempValue);
                }, 0);
            }
        }
        if (changes && changes.disabled && changes.disabled.currentValue) {
            this.control.disable();
        }
        else {
            this.disabled = false;
            this.control.enable();
        }
    }
    ngOnInit() {
        if (this.options) {
            this.setItems('');
        }
    }
    keyUpFunction(event, value) {
        if (event.key === 'Enter' || event.key === 'Tab') {
            event.preventDefault();
            return false;
        }
        else {
            if (value) {
                const data = this.filterList.filter(e => e[this.refName].toLowerCase() === value.toLowerCase());
                if (data.length > 0) {
                    this.keyUp = true;
                }
                else {
                    this.keyUp = true;
                }
            }
            else {
                this.keyUp = false;
            }
            this.propValueEvent.emit({
                propertyName: this.control,
                // tslint:disable-next-line: object-literal-shorthand
                value: value
            });
        }
    }
    get displayDataFn() {
        const dataNew = (data) => {
            if (data == null || data === undefined || data === '') {
                return null;
            }
            else {
                if (this.filterList && this.filterList.length > 0) {
                    data = this.options.find(x => x[this.refId] === data);
                    if (data) {
                        return data[this.refName];
                    }
                    else {
                        return null;
                    }
                }
                else {
                    return null;
                }
            }
        };
        return dataNew;
    }
    // Resource ..
    setItems(value) {
        if (!value) {
            this.assignResourceCopy();
        }
        if (value) {
            this.filterList = Object.assign([], this.options).filter(item => ((item[this.refName].toLowerCase().indexOf(value.toLowerCase()) > -1)));
        }
    }
    assignResourceCopy() {
        this.filterList = Object.assign([], this.options);
    }
    checkValidValue() {
        const value = this.control.value;
        if (value === '' || value == null) {
        }
        else if (this.keyUp) {
            this.control.setErrors({ incorrect: true });
        }
        else {
            this.control.setErrors(null);
        }
    }
    checVal(value) {
        if (this.showDefaultSelect === false) {
            const data = this.options.filter(e => e[this.refName].toLowerCase().trim() ===
                value.toLowerCase().trim());
            if (data.length > 0) {
                const datax = data[0];
                this.control
                    .setValue(datax[this.refId]);
                // this.selectionChange.emit({event:{option:datax[this.refId]}});
                this.keyUp = false;
            }
            this.checkValidValue();
        }
    }
    emitValues(event) {
        this.selectionChange.emit(event.option.value);
        this.propValueEvent.emit({
            propertyName: this.control,
            value: event.option.value
        });
    }
}
NgxMatAutocompleteControlComponent.decorators = [
    { type: Component, args: [{
                selector: 'ngx-mat-autocomplete-control',
                template: "  <mat-form-field [appearance]=\"appearance\" style=\"width: 100%;\">\r\n    <mat-label>{{label}} </mat-label>\r\n    <input #inputvalue  matInput [placeholder]=\"showPlaceholder?label:''\" \r\n     [matAutocomplete]=\"autoCmpt\" [formControl]=\"control\" \r\n      (focus)=\"setItems(inputvalue.value)\" (keypress)=\"keyUpFunction($event, inputvalue.value)\"\r\n      (input)=\"setItems(inputvalue.value)\"\r\n       (blur)=\"checVal(inputvalue.value);\" (click)=\"inputvalue.select()\"\r\n      [required]=\"required\" />\r\n  \r\n    <mat-error *ngIf=\"control?.errors?.required && required\">\r\n      {{label}} is required\r\n    </mat-error>\r\n    <mat-error *ngIf=\"control?.errors?.incorrect\">\r\n      {{label}} is not valid.\r\n    </mat-error>\r\n  \r\n    <mat-autocomplete #autoCmpt=\"matAutocomplete\" [displayWith]=\"displayDataFn\"\r\n     (optionSelected)=\"emitValues($event)\">\r\n      <!-- <mat-option>-------Select {{label}}-------</mat-option> -->\r\n      <mat-option [value]=\"data[refId]\" *ngFor=\"let data of filterList\" class=\"autocom-option autocom-tr\">\r\n        <span [innerHTML]=\"data[refName] | highlight: inputvalue.value \"></span>\r\n      </mat-option>\r\n      <mat-option *ngIf=\"filterList.length == 0\">\r\n        <div class=\"no-record\"><span>No Data Found</span></div>\r\n      </mat-option>\r\n    </mat-autocomplete>\r\n  \r\n  </mat-form-field>",
                styles: [".no-record{color:#78797b;font-size:14px;font-weight:300;line-height:.5;margin:.5rem 0;padding:30px 20px}.no-record span:after,.no-record span:before{border-bottom:1px solid rgba(0,0,0,.1);border-top:1px solid rgba(0,0,0,.1);content:\"\";display:inline-block;height:3px;position:relative;top:-2px;width:20px}.no-record span:before{margin-right:5px}.no-record span:after{margin-left:5px}.mat-option-text b{color:#3f51b5}"]
            },] }
];
NgxMatAutocompleteControlComponent.ctorParameters = () => [];
NgxMatAutocompleteControlComponent.propDecorators = {
    control: [{ type: Input }],
    refId: [{ type: Input }],
    refName: [{ type: Input }],
    label: [{ type: Input }],
    appearance: [{ type: Input }],
    options: [{ type: Input }],
    required: [{ type: Input }],
    showDefaultSelect: [{ type: Input }],
    disabled: [{ type: Input }],
    value: [{ type: Input }],
    showPlaceholder: [{ type: Input }],
    selectionChange: [{ type: Output }],
    propValueEvent: [{ type: Output }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LW1hdC1hdXRvY29tcGxldGUtY29udHJvbC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vLi4vcHJvamVjdHMvbmd4LW1hdC1hdXRvY29tcGxldGUtY29udHJvbC9zcmMvIiwic291cmNlcyI6WyJsaWIvbmd4LW1hdC1hdXRvY29tcGxldGUtY29udHJvbC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBcUIsS0FBSyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQWlCLE1BQU0sZUFBZSxDQUFDO0FBT3pHLE1BQU0sT0FBTyxrQ0FBa0M7SUFxQjdDO1FBaEJTLGVBQVUsR0FBRyxTQUFTLENBQUM7UUFDdkIsWUFBTyxHQUFHLEVBQUUsQ0FBQztRQUNiLGFBQVEsR0FBRyxLQUFLLENBQUM7UUFDakIsc0JBQWlCLEdBQUcsS0FBSyxDQUFDO1FBQzFCLGFBQVEsR0FBRyxLQUFLLENBQUM7UUFFakIsb0JBQWUsR0FBRyxJQUFJLENBQUM7UUFDaEMsMkJBQTJCO1FBQzNCLGdDQUFnQztRQUNoQyw2QkFBNkI7UUFFbkIsb0JBQWUsR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDO1FBQzFDLG1CQUFjLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUNuRCxVQUFLLEdBQUcsS0FBSyxDQUFDO1FBQ2QsZUFBVSxHQUFHLEVBQUUsQ0FBQztJQUdoQixDQUFDO0lBQ0QsV0FBVyxDQUFDLE9BQXNCO1FBQ2hDLElBQUksT0FBTyxFQUFFO1lBQ1gsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtnQkFDNUMsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQztnQkFDcEMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQztnQkFDbEIsVUFBVSxDQUFDLEdBQUcsRUFB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QUFDLENBQUMsQ0FBQyxDQUFDO2dCQUN0QixJQUFJLENBQUMsT0FBTztxQkFDVCxRQUFRLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO2dCQUMvQixpRUFBaUU7Z0JBQ2pFLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO2FBQ3BCO1lBQ0QsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDO1NBQ3hCO0lBQ0gsQ0FBQztJQUNELFVBQVUsQ0FBQyxLQUFLO1FBQ2QsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUM5QyxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQztZQUN2QixZQUFZLEVBQUUsSUFBSSxDQUFDLE9BQU87WUFDMUIsS0FBSyxFQUFFLEtBQUssQ0FBQyxNQUFNLENBQUMsS0FBSztTQUMxQixDQUFDLENBQUM7SUFDTCxDQUFDOzs7WUF6SUYsU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSw4QkFBOEI7Z0JBQ3hDLG80Q0FBa0M7O2FBRW5DOzs7O3NCQUVFLEtBQUs7b0JBQ0wsS0FBSztzQkFDTCxLQUFLO29CQUNMLEtBQUs7eUJBQ0wsS0FBSztzQkFDTCxLQUFLO3VCQUNMLEtBQUs7Z0NBQ0wsS0FBSzt1QkFDTCxLQUFLO29CQUNMLEtBQUs7OEJBQ0wsS0FBSzs4QkFLTCxNQUFNOzZCQUNOLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgT25DaGFuZ2VzLCBJbnB1dCwgT3V0cHV0LCBFdmVudEVtaXR0ZXIsIFNpbXBsZUNoYW5nZXMgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEZvcm1Db250cm9sIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnbmd4LW1hdC1hdXRvY29tcGxldGUtY29udHJvbCcsXG4gIHRlbXBsYXRlVXJsOiAnLi9hdXRvY29tcGxldGUuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL2F1dG9jb21wbGV0ZS5jc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBOZ3hNYXRBdXRvY29tcGxldGVDb250cm9sQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMge1xuICBASW5wdXQoKSBjb250cm9sOiBGb3JtQ29udHJvbDtcbiAgQElucHV0KCkgcmVmSWQ6IHN0cmluZztcbiAgQElucHV0KCkgcmVmTmFtZTogc3RyaW5nO1xuICBASW5wdXQoKSBsYWJlbDogc3RyaW5nO1xuICBASW5wdXQoKSBhcHBlYXJhbmNlID0gJ291dGxpbmUnO1xuICBASW5wdXQoKSBvcHRpb25zID0gW107XG4gIEBJbnB1dCgpIHJlcXVpcmVkID0gZmFsc2U7XG4gIEBJbnB1dCgpIHNob3dEZWZhdWx0U2VsZWN0ID0gZmFsc2U7XG4gIEBJbnB1dCgpIGRpc2FibGVkID0gZmFsc2U7XG4gIEBJbnB1dCgpIHZhbHVlOiBhbnk7XG4gIEBJbnB1dCgpIHNob3dQbGFjZWhvbGRlciA9IHRydWU7IFxuICAvLyBASW5wdXQoKSBpbnB1dFRleHQgPSAnJztcbiAgLy8gQElucHV0KCkgcmVhY3RpdmVGb3JtID0gdHJ1ZTtcbiAgLy8gQElucHV0KCkgbW9kZWxOYW1lID0gdHJ1ZTtcblxuICBAT3V0cHV0KCkgc2VsZWN0aW9uQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoKSBwcm9wVmFsdWVFdmVudCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBrZXlVcCA9IGZhbHNlO1xuICBmaWx0ZXJMaXN0ID0gW107XG4gIHRlbXBWYWx1ZTogYW55O1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgfVxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XG4gICAgaWYgKGNoYW5nZXMpIHtcbiAgICAgIGlmICgrdGhpcy52YWx1ZSA+IDAgfHwgdGhpcy52YWx1ZS5sZW5ndGggPiAwKSB7XG4gICAgICAgIHRoaXMudGVtcFZhbHVlID0gdGhpcy5jb250cm9sLnZhbHVlO1xuICAgICAgICB0aGlzLnNldEl0ZW1zKCcnKTtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgdGhpcy5jb250cm9sLnNldFZhbHVlKHRoaXMudGVtcFZhbHVlKTtcbiAgICAgICAgfSwgMCk7XG4gICAgICB9XG5cbiAgICB9XG4gICAgaWYgKGNoYW5nZXMgJiYgY2hhbmdlcy5kaXNhYmxlZCAmJiBjaGFuZ2VzLmRpc2FibGVkLmN1cnJlbnRWYWx1ZSkge1xuICAgICAgdGhpcy5jb250cm9sLmRpc2FibGUoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgdGhpcy5jb250cm9sLmVuYWJsZSgpO1xuXG4gICAgfVxuICB9XG4gIG5nT25Jbml0KCkge1xuICAgIGlmICh0aGlzLm9wdGlvbnMpIHtcbiAgICAgIHRoaXMuc2V0SXRlbXMoJycpO1xuICAgIH1cbiAgfVxuICBrZXlVcEZ1bmN0aW9uKGV2ZW50LCB2YWx1ZSkge1xuICAgIGlmIChldmVudC5rZXkgPT09ICdFbnRlcicgfHwgZXZlbnQua2V5ID09PSAnVGFiJykge1xuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmZpbHRlckxpc3QuZmlsdGVyKGUgPT5cbiAgICAgICAgICBlW3RoaXMucmVmTmFtZV0udG9Mb3dlckNhc2UoKSA9PT0gdmFsdWUudG9Mb3dlckNhc2UoKSk7XG4gICAgICAgIGlmIChkYXRhLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICB0aGlzLmtleVVwID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLmtleVVwID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5rZXlVcCA9IGZhbHNlO1xuICAgICAgfVxuICAgICAgdGhpcy5wcm9wVmFsdWVFdmVudC5lbWl0KHtcbiAgICAgICAgcHJvcGVydHlOYW1lOiB0aGlzLmNvbnRyb2wsXG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogb2JqZWN0LWxpdGVyYWwtc2hvcnRoYW5kXG4gICAgICAgIHZhbHVlOiB2YWx1ZVxuICAgICAgfSk7XG4gICAgfVxuICB9XG4gIGdldCBkaXNwbGF5RGF0YUZuKCkge1xuICAgIGNvbnN0IGRhdGFOZXcgPSAoZGF0YSkgPT4ge1xuICAgICAgaWYgKGRhdGEgPT0gbnVsbCB8fCBkYXRhID09PSB1bmRlZmluZWQgfHwgZGF0YSA9PT0gJycpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAodGhpcy5maWx0ZXJMaXN0ICYmIHRoaXMuZmlsdGVyTGlzdC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgZGF0YSA9IHRoaXMub3B0aW9ucy5maW5kKHggPT4geFt0aGlzLnJlZklkXSA9PT0gZGF0YSk7XG4gICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgIHJldHVybiBkYXRhW3RoaXMucmVmTmFtZV07XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG4gICAgcmV0dXJuIGRhdGFOZXc7XG4gIH1cbiAgLy8gUmVzb3VyY2UgLi5cbiAgc2V0SXRlbXModmFsdWUpIHtcbiAgICBpZiAoIXZhbHVlKSB7IHRoaXMuYXNzaWduUmVzb3VyY2VDb3B5KCk7IH1cbiAgICBpZiAodmFsdWUpIHtcbiAgICAgIHRoaXMuZmlsdGVyTGlzdCA9IE9iamVjdC5hc3NpZ24oW10sIHRoaXMub3B0aW9ucykuZmlsdGVyKFxuICAgICAgICBpdGVtID0+ICgoaXRlbVt0aGlzLnJlZk5hbWVdLnRvTG93ZXJDYXNlKCkuaW5kZXhPZih2YWx1ZS50b0xvd2VyQ2FzZSgpKSA+IC0xKSkpO1xuICAgIH1cblxuICB9XG4gIGFzc2lnblJlc291cmNlQ29weSgpIHtcbiAgICB0aGlzLmZpbHRlckxpc3QgPSBPYmplY3QuYXNzaWduKFtdLCB0aGlzLm9wdGlvbnMpO1xuICB9XG5cbiAgY2hlY2tWYWxpZFZhbHVlKCkge1xuICAgIGNvbnN0IHZhbHVlID0gdGhpcy5jb250cm9sLnZhbHVlO1xuICAgIGlmICh2YWx1ZSA9PT0gJycgfHwgdmFsdWUgPT0gbnVsbCkge1xuICAgIH0gZWxzZSBpZiAodGhpcy5rZXlVcCkge1xuICAgICAgdGhpcy5jb250cm9sLnNldEVycm9ycyh7IGluY29ycmVjdDogdHJ1ZSB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5jb250cm9sLnNldEVycm9ycyhudWxsKTtcbiAgICB9XG4gIH1cblxuICBjaGVjVmFsKHZhbHVlKSB7XG4gICAgaWYgKHRoaXMuc2hvd0RlZmF1bHRTZWxlY3QgPT09IGZhbHNlKSB7XG4gICAgICBjb25zdCBkYXRhOiBhbnkgPSB0aGlzLm9wdGlvbnMuZmlsdGVyKGUgPT4gZVt0aGlzLnJlZk5hbWVdLnRvTG93ZXJDYXNlKCkudHJpbSgpID09PVxuICAgICAgICB2YWx1ZS50b0xvd2VyQ2FzZSgpLnRyaW0oKSk7XG4gICAgICBpZiAoZGF0YS5sZW5ndGggPiAwKSB7XG4gICAgICAgIGNvbnN0IGRhdGF4ID0gZGF0YVswXTtcbiAgICAgICAgdGhpcy5jb250cm9sXG4gICAgICAgICAgLnNldFZhbHVlKGRhdGF4W3RoaXMucmVmSWRdKTtcbiAgICAgICAgLy8gdGhpcy5zZWxlY3Rpb25DaGFuZ2UuZW1pdCh7ZXZlbnQ6e29wdGlvbjpkYXRheFt0aGlzLnJlZklkXX19KTtcbiAgICAgICAgdGhpcy5rZXlVcCA9IGZhbHNlO1xuICAgICAgfVxuICAgICAgdGhpcy5jaGVja1ZhbGlkVmFsdWUoKTtcbiAgICB9XG4gIH1cbiAgZW1pdFZhbHVlcyhldmVudCkge1xuICAgIHRoaXMuc2VsZWN0aW9uQ2hhbmdlLmVtaXQoZXZlbnQub3B0aW9uLnZhbHVlKTtcbiAgICB0aGlzLnByb3BWYWx1ZUV2ZW50LmVtaXQoe1xuICAgICAgcHJvcGVydHlOYW1lOiB0aGlzLmNvbnRyb2wsXG4gICAgICB2YWx1ZTogZXZlbnQub3B0aW9uLnZhbHVlXG4gICAgfSk7XG4gIH1cbn0iXX0=